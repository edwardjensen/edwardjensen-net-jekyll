# Staging Configuration Templates
# Used by .github/workflows/deploy-staging.yml to generate _config.staging.yml at build time
#
# Configuration is determined by two dimensions:
# - site_code: 'main' (current main branch) or 'latest-tag' (latest vX.Y.Z release)
# - cms_source: 'production' or 'staging'

# Trigger mappings: determines config based on how the workflow was triggered
# For workflow_dispatch, values come from user input
# For push/repository_dispatch, values are looked up here
triggers:
  # Push to main branch
  push:
    site_code: main
    cms_source: staging
    deploy_target: cloudflare

  # Repository dispatch events (webhooks from CMS)
  repository_dispatch:
    staging_cms_publish:
      site_code: latest-tag
      cms_source: staging
      deploy_target: local-server
    staging_cms_photo_publish:
      site_code: main
      cms_source: staging
      deploy_target: local-server

# Defaults for workflow_dispatch (manual triggers)
defaults:
  site_code: main
  cms_source: production
  deploy_target: local-server

# Base configuration applied to all staging builds
base:
  url: "https://stagingsite.edwardjensencms.com"

# Staging CMS GraphQL endpoint (only used when cms_source: staging)
staging_cms:
  payload_graphql:
    url: "https://staging-tailscale.edwardjensencms.com/api/graphql"

# Title templates based on configuration combination
# Variables: {site_code}, {cms_source}
titles:
  main_production: "Edward Jensen [CODE STAGING]"
  main_staging: "Edward Jensen [STAGING CMS + CODE]"
  latest-tag_production: "Edward Jensen [TAG STAGING]"
  latest-tag_staging: "Edward Jensen [CMS STAGING]"

# Deploy target overrides (applied after base config)
deploy_targets:
  cloudflare:
    url: "https://staging.edwardjensen.net"
