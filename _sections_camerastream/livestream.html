---
section: Live Camera
subheader: Automatically plays if the stream is live
icon: camera-reels-fill
order: 10
icon_bg_color: from-emerald-500 to-teal-600
---

<div x-data="{ isLive: true, checking: true }">
  <!-- Stream container (always present, visibility controlled) -->
  <div x-show="isLive" class="aspect-video w-full relative">
    <iframe
      id="stream-iframe"
      src="https://stpcamera.edwardjensenprojects.com/iframe?autoplay=true&muted=true"
      class="w-full h-full rounded-lg"
      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
      title="Downtown Saint Paul Live Camera Stream"
    ></iframe>
  </div>

  <!-- Stream is offline -->
  <div x-show="!isLive" x-cloak class="w-full flex flex-col items-center justify-center bg-brand-grey/10 rounded-lg text-center px-8 py-12">
    <i class="bi bi-camera-video-off text-4xl text-muted mb-4" aria-hidden="true"></i>
    <p class="text-heading text-lg font-medium mb-2">The stream is currently offline</p>
    <p class="text-muted">Check back later to see the live view of downtown Saint Paul. Check <a href="https://bsky.app/profile/edwardjensen.net">Bluesky for updates</a>.</p>
  </div>
</div>

<script src="https://embed.cloudflarestream.com/embed/sdk.latest.js"></script>
<script>
  document.addEventListener('alpine:init', () => {
    const iframe = document.getElementById('stream-iframe');
    if (iframe && window.Stream) {
      const player = Stream(iframe);
      player.addEventListener('error', () => {
        const component = Alpine.$data(iframe.closest('[x-data]'));
        if (component) {
          component.isLive = false;
          component.checking = false;
        }
      });
      player.addEventListener('playing', () => {
        const component = Alpine.$data(iframe.closest('[x-data]'));
        if (component) {
          component.isLive = true;
          component.checking = false;
        }
      });
      // Check for stalled/waiting state which indicates no content
      player.addEventListener('stalled', () => {
        const component = Alpine.$data(iframe.closest('[x-data]'));
        if (component) {
          component.isLive = false;
          component.checking = false;
        }
      });
    }
  });
</script>