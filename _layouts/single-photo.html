---
layout: content-wrapper
---
<!--
  Single Photo Page
  This page renders for direct URL access and search engines.
  JavaScript will fetch the gallery and display this photo in a modal.
  The static HTML below serves as a fallback for no-JS/SEO.
-->
<div id="single-photo-container" data-photo-url="{{ page.url }}" data-gallery-url="/photos/">
  <article class="article-container">
    <!-- Featured Photo (the star of the page) -->
    <figure class="relative" role="doc-illustration">
      <img class="w-full h-auto object-contain"
           src="{{ page.image | relative_url }}"
           alt="{{ page.image_alt | default: page.title }}"
           loading="lazy">
    </figure>

    <!-- Content Area -->
    <div class="p-8 lg:p-12">
      <!-- Minimal Header -->
      <header class="mb-8">
        <h1 class="font-header font-bold text-2xl lg:text-4xl text-heading leading-tight tracking-wide mb-3">
          {{ page.title }}
        </h1>

        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 text-sm">
          <time datetime="{{ page.date | date_to_xmlschema }}" class="text-muted">
            {{ page.date | date: "%-d %B %Y" }}
          </time>

          {% if page.tags and page.tags.size > 0 %}
          <div class="flex flex-wrap gap-2" role="list" aria-label="Photo tags">
            {% for tag in page.tags %}
            <span class="bg-amber-500/20 text-amber-700 dark:text-amber-300 px-2 py-1 rounded-md text-xs font-medium border border-amber-400/30 transition-colors duration-300" role="listitem">
              #{{ tag }}
            </span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </header>

      <!-- Prose Content (if body content exists) -->
      {% if page.content and page.content != "" %}
      {% assign stripped_content = page.content | strip %}
      {% if stripped_content != "" %}
      <div class="mb-8">
        {% include components/prose-content.html %}
      </div>
      {% endif %}
      {% endif %}

      <!-- EXIF Metadata (conditionally rendered) -->
      {% if page.exif_camera or page.exif_lens or page.exif_focal_length or page.exif_aperture or page.exif_shutter_speed or page.exif_iso %}
      {% include components/photo-metadata.html %}
      {% endif %}

      <!-- Location Map (conditionally rendered - component handles its own check) -->
      {% include components/photo-location-map.html %}

      <!-- Photo Navigation -->
      {% include components/photo-navigation.html %}

      <!-- Back to Gallery Link -->
      <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700">
        <a href="/photos/" class="link-accent">
          <i class="bi bi-arrow-left me-2"></i>Back to Photography Gallery
        </a>
      </div>
    </div>
  </article>
</div>

<script>
// Transform single photo page to gallery + modal for seamless experience
(function() {
  const container = document.getElementById('single-photo-container');
  if (!container) return;

  const photoUrl = container.dataset.photoUrl;
  const galleryUrl = container.dataset.galleryUrl;

  // Fetch the gallery page
  fetch(galleryUrl)
    .then(response => {
      if (!response.ok) throw new Error('Failed to fetch gallery');
      return response.text();
    })
    .then(html => {
      // Parse the gallery HTML
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // Get the main content and photo data
      const galleryMain = doc.getElementById('main-content');
      const photoDataScript = doc.getElementById('photo-gallery-data');

      if (!galleryMain || !photoDataScript) {
        console.log('Gallery elements not found, using fallback view');
        return;
      }

      // Replace current main content with gallery content
      const currentMain = document.getElementById('main-content');
      if (currentMain) {
        currentMain.innerHTML = galleryMain.innerHTML;

        // Add the photo data script to the page
        const newScript = document.createElement('script');
        newScript.id = 'photo-gallery-data';
        newScript.type = 'application/json';
        newScript.textContent = photoDataScript.textContent;
        currentMain.insertBefore(newScript, currentMain.firstChild);

        // Initialize Alpine.js on the new content
        const galleryContainer = currentMain.querySelector('[x-data="photoGallery()"]');
        if (galleryContainer && window.Alpine) {
          // Initialize the Alpine component
          Alpine.initTree(galleryContainer);

          // Wait for Alpine to initialize, then open the photo
          setTimeout(() => {
            if (window.photoGalleryInstance) {
              // Replace state instead of push since we're already on this URL
              window.photoGalleryInstance.openPhoto(
                window.photoGalleryInstance.findPhotoByUrl(photoUrl),
                false // Don't push state, we're already on this URL
              );
            }
          }, 150);
        }
      }
    })
    .catch(err => {
      console.log('Failed to load gallery, using fallback view:', err.message);
      // Fallback view is already rendered, so we're fine
    });
})();
</script>
