{% comment %}
  Photo Location Map Component
  Displays a Google Maps Static API image for photo location.
  Self-contained - handles its own conditional rendering.

  Required fields (both must be present for map to display):
    page.location_lat - Latitude coordinate
    page.location_lng - Longitude coordinate

  Optional fields:
    page.location_point_of_interest - Point of interest name
    page.location_neighborhood - Neighborhood name
    page.location_city - City name
    page.location_state - State name
    page.location_country - Country name

  Configuration (in _data/google-maps.yml, one of these must be set):
    proxy_url - Cloudflare Worker proxy URL (production)
    api_key - Direct API key (dev/staging)
{% endcomment %}

{% if page.location_lat and page.location_lng %}
{% assign map_settings = site.data.google-maps %}
{% assign map_zoom = map_settings.zoom | default: 15 %}
{% assign map_size = map_settings.size | default: "640x360" %}
{% assign map_scale = map_settings.scale | default: 2 %}
{% assign map_type = map_settings.maptype | default: "roadmap" %}
{% capture map_params %}center={{ page.location_lat }},{{ page.location_lng }}&zoom={{ map_zoom }}&size={{ map_size }}&scale={{ map_scale }}&maptype={{ map_type }}{% endcapture %}

{% if map_settings.proxy_url %}
  {% assign map_url = map_settings.proxy_url | append: "?" | append: map_params %}
{% elsif map_settings.api_key %}
  {% assign map_url = "https://maps.googleapis.com/maps/api/staticmap?" | append: map_params | append: "&key=" | append: map_settings.api_key %}
{% endif %}

{% if map_url %}
<aside class="section-bg rounded-lg p-6 my-6 transition-colors duration-300" role="complementary" aria-label="Photo location">
  <h2 class="text-sm font-semibold text-heading uppercase tracking-wide mb-4">
    <i class="ph ph-map-pin me-2" aria-hidden="true"></i>Location
  </h2>

  {% if page.location_point_of_interest or page.location_neighborhood or page.location_city or page.location_state or page.location_country %}
  <p class="text-body mb-4">
    {% if page.location_point_of_interest %}{{ page.location_point_of_interest }}{% if page.location_neighborhood or page.location_city or page.location_state %}, {% endif %}{% endif %}
    {% if page.location_neighborhood %}{{ page.location_neighborhood }}{% if page.location_city or page.location_state %}, {% endif %}{% endif %}
    {% if page.location_city %}{{ page.location_city }}{% if page.location_state %}, {% endif %}{% endif %}
    {% if page.location_state %}{{ page.location_state }}{% if page.location_country %}, {% endif %}{% endif %}
    {% if page.location_country %}{{ page.location_country }}{% endif %}
  </p>
  {% endif %}

  <div class="aspect-video w-full rounded-lg overflow-hidden bg-brand-grey/20 dark:bg-brand-grey/30">
    <img
      src="{{ map_url }}"
      alt="Map showing photo location{% if page.location_city %}: {{ page.location_city }}{% if page.location_state %}, {{ page.location_state }}{% endif %}{% endif %}"
      class="w-full h-full object-cover"
      loading="lazy">
  </div>
</aside>
{% endif %}
{% endif %}
