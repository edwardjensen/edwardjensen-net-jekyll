{% comment %}
Unified post listing component
Iterates through site.posts grouped by year (deduplicated and sorted by date, newest first)
{% endcomment %}

{% assign unique_posts = site.posts | uniq: 'title' | sort: 'date' | reverse %}
{% assign posts_by_year = unique_posts | group_by_exp: "post", "post.date | date: '%Y'" %}

<div class="space-y-8">
  {% for year in posts_by_year %}
    <div>
      <h2 class="text-2xl font-bold text-heading mb-4 border-b border-brand-grey/20 dark:border-brand-grey/30 pb-2">
        {{ year.name }}
      </h2>
      <div class="space-y-3">
        {% for post in year.items %}
          <article class="group">
            <a href="{{ post.url | relative_url }}" class="block list-item-hover p-3 -m-3">
              <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-2">
                <h3 class="{% if post.ejnet %}italic{% endif %} text-heading group-hover:text-brand-chestnut font-bold transition-colors duration-200">
                  {{ post.title }}
                </h3>
                <time class="text-sm text-muted lg:ml-4 flex-shrink-0" datetime="{{ post.date | date: '%Y-%m-%d' }}">
                  {{ post.date | date: "%e %B %Y" }}
                </time>
              </div>
              {% if post.excerpt %}
                <p class="text-sm text-muted mt-1 line-clamp-2">
                  {{ post.excerpt | strip_html }}
                </p>
              {% endif %}
            </a>
          </article>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>

<div class="mt-12 pt-8 border-t border-brand-grey/20 dark:border-brand-grey/30">
  <a href="/archive" class="inline-flex items-center gap-2 text-lg font-semibold text-heading hover:text-brand-chestnut transition-colors duration-200">
    <i class="ph ph-archive"></i>
    Historical and Retired Posts
  </a>
</div>